<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Biology Quiz ‚Äî Galaxy</title>
<style>
  :root{--overlay:rgba(0,0,0,0.6);--gold:#ffd54a}
  html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:#000;color:#fff;overflow:hidden}
  #bg-video{position:fixed;inset:0;z-index:-2;min-width:100%;min-height:100%;object-fit:cover;filter:brightness(0.95)}
  #music-audio{display:none}
  .app{position:relative;z-index:2;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:14px;box-sizing:border-box}
  header{width:100%;display:flex;align-items:center;justify-content:space-between;gap:10px;pointer-events:none}
  .center-top{position:absolute;left:50%;transform:translateX(-50%);top:10px;pointer-events:auto;z-index:5}
  .score-tab{background:rgba(255,255,255,0.06);backdrop-filter:blur(6px);padding:8px 14px;border-radius:20px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:600}
  .score-tab:hover{background:rgba(255,255,255,0.09)}
  .gear{position:absolute;right:16px;top:8px;pointer-events:auto;cursor:pointer;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:8px;background:rgba(255,255,255,0.04)}
  .gear:hover{background:rgba(255,255,255,0.06)}
  .quiz-container{margin-top:80px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:12px;width:100%;max-width:920px;padding:12px}
  .panel{width:100%;max-width:820px;background:rgba(0,0,0,0.45);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.6);}
  .question{font-size:1.3rem;text-align:center;margin-bottom:8px}
  .options{display:flex;flex-direction:column;gap:8px}
  .options button{padding:12px;border-radius:10px;border:none;background:rgba(255,255,255,0.06);color:#fff;font-size:1rem;cursor:pointer;text-align:left}
  .options button:hover{background:rgba(255,255,255,0.09)}
  #scoreline{margin-top:6px;font-weight:600}
  #progress-container{width:100%;background:rgba(255,255,255,0.08);height:10px;border-radius:6px;overflow:hidden}
  #progress-bar{height:100%;background:limegreen;width:0%}
  #timer-num{font-weight:700;margin-top:6px}
  #timer-bar{height:8px;background:tomato;border-radius:6px;width:0%;transition:width 0.2s linear}
  .overlay{position:fixed;inset:0;background:var(--overlay);z-index:10;display:none;align-items:flex-start;justify-content:center}
  .score-panel{margin-top:60px;background:rgba(10,10,10,0.98);color:#fff;padding:14px;border-radius:8px;max-width:720px;width:90%;box-shadow:0 12px 40px rgba(0,0,0,0.7);transform-origin:top center;transform:translateY(-20px);opacity:0;transition:all 300ms ease}
  .score-panel.open{transform:translateY(0);opacity:1}
  .score-row{display:flex;justify-content:space-between;padding:8px 6px;border-bottom:1px solid rgba(255,255,255,0.03);align-items:center}
  .best{color:var(--gold);font-weight:800;text-shadow:0 0 8px rgba(255,213,74,0.15)}
  .crown{margin-right:6px}
  .settings-drawer{position:fixed;right:-420px;top:0;height:100%;width:380px;background:rgba(6,6,6,0.98);z-index:20;padding:20px;box-shadow:-12px 0 40px rgba(0,0,0,0.6);transition:right 350ms ease;overflow:auto}
  .settings-drawer.open{right:0}
  .close-hint{font-size:0.9rem;color:rgba(255,255,255,0.6);margin-bottom:8px}
  .settings-row{margin:10px 0;display:flex;flex-direction:column;gap:8px}
  .small{font-size:0.9rem;color:rgba(255,255,255,0.7)}
  .muted-note{font-size:0.85rem;color:rgba(255,255,255,0.45)}
  .top-controls{display:flex;gap:10px;align-items:center}
  .btn{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;background:rgba(255,255,255,0.06);color:#fff}
  .btn.primary{background:linear-gradient(90deg,#2fb8ff,#9b59ff);color:#000;font-weight:700}
  footer{position:fixed;left:12px;bottom:12px;z-index:6;color:rgba(255,255,255,0.6);font-size:0.85rem}
  @media (max-width:640px){.settings-drawer{width:100%;}.panel{padding:8px}.question{font-size:1.1rem}}
</style>
</head>
<body>
  <video id="bg-video" autoplay muted loop playsinline>
    <source src="assets/background.mp4" type="video/mp4">
  </video>
  <audio id="music-audio" loop src="assets/ambient_loop.wav"></audio>

  <div class="app">
    <header>
      <div style="width:60px"></div>
      <div class="center-top">
        <div id="score-tab" class="score-tab" title="Open scoreboard (S)">
          üìä Scores
        </div>
      </div>
      <div class="gear" id="gear" title="Settings (open/close)">
        ‚öôÔ∏è
      </div>
    </header>

    <div class="quiz-container">
      <div class="panel">
        <div class="question" id="question">Loading...</div>
        <div class="options" id="options"></div>
        <div id="scoreline" class="small">Score: 0</div>
        <div id="progress-container"><div id="progress-bar"></div></div>
        <div id="timer-wrap" style="display:none;margin-top:8px">
          <div id="timer-num">30</div>
          <div style="width:100%;background:rgba(255,255,255,0.06);height:10px;border-radius:6px;overflow:hidden"><div id="timer-bar"></div></div>
        </div>
      </div>
    </div>

    <div id="overlay" class="overlay" style="display:none;align-items:flex-start">
      <div id="score-panel" class="score-panel" role="dialog" aria-modal="true">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-weight:800">Scoreboard</div>
          <div id="collapse-scoreboard" style="cursor:pointer;opacity:0.8">‚úñ</div>
        </div>
        <div id="current-run" style="margin-bottom:8px"></div>
        <div id="history-list"></div>
        <div id="best-row" style="margin-top:8px"></div>
      </div>
    </div>

    <div id="settings" class="settings-drawer" aria-hidden="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:800">Settings</div>
        <div id="close-settings" style="cursor:pointer">‚úñ</div>
      </div>
      <div class="close-hint">Close by tapping outside or hitting the gear again.</div>

      <div class="settings-row">
        <div style="font-weight:700">Game Mode</div>
        <label><input type="radio" name="mode" value="normal" checked> Normal (no timer)</label>
        <label><input type="radio" name="mode" value="timed"> Timed</label>
        <div id="timed-options" style="margin-top:6px;display:none">
          <label><input type="radio" name="time" value="15"> 15 sec</label>
          <label><input type="radio" name="time" value="30" checked> 30 sec</label>
          <label><input type="radio" name="time" value="60"> 60 sec</label>
        </div>
      </div>

      <div class="settings-row">
        <div style="font-weight:700">Music</div>
        <label><input type="checkbox" id="music-toggle"> Play background music</label>
        <div class="small muted-note">You can upload your own track below (mp3/wav). Default included.</div>
        <input type="file" id="music-upload" accept="audio/*">
        <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
          <input id="music-volume" type="range" min="0" max="1" step="0.01" value="0.35">
          <div class="small">Volume</div>
        </div>
      </div>

      <div class="settings-row">
        <div style="font-weight:700">Questions</div>
        <div class="small">Upload a JSON file of questions in same schema (question/options/answer index) to replace the pool.</div>
        <input type="file" id="questions-upload" accept=".json,.txt">
        <div class="small muted-note">Default set is Biology Chapter 3.</div>
      </div>

      <div class="settings-row">
        <div style="font-weight:700">Scoreboard</div>
        <button id="clear-scores" class="btn">Clear Scoreboard</button>
      </div>

      <div style="margin-top:20px;display:flex;gap:8px">
        <button id="start-quiz" class="btn primary">Start Quiz</button>
        <button id="start-quiz-norm" class="btn">Start (Normal)</button>
      </div>

      <div style="margin-top:20px;color:rgba(255,255,255,0.6);font-size:0.9rem">
        Tips: Use 1-4 to answer, arrows to navigate, S to toggle scoreboard. Swipe on mobile.
      </div>
    </div>

    <footer>Biology Quiz ‚Äî Chapter 3</footer>
  </div>

<script>
// Force slow video playback
const vid=document.getElementById('bg-video');vid.playbackRate=0.1;

// Load questions.json
let originalQuestions = null;
async function loadDefaultQuestions(){
  const res = await fetch('questions.json');
  originalQuestions = await res.json();
}
loadDefaultQuestions();

// State
let questions = [];
let current = 0;
let score = 0;
let timer = null;
let timeLeft = 30;
let timedMode = false;
let timedSeconds = 30;
let musicEnabled = false;
const musicAudio = document.getElementById('music-audio');
musicAudio.volume = 0.35;

// Utility shuffle
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]} return arr; }

// Scoreboard storage
function getScores(){ try{ return JSON.parse(localStorage.getItem('quiz_scores')||'[]') }catch(e){return[]} }
function saveScores(arr){ localStorage.setItem('quiz_scores', JSON.stringify(arr.slice(-50))) }
function addScoreEntry(correct,total){
  const now = new Date();
  const entry = {time: now.toLocaleString(), correct, total, pct: Math.round((correct/total)*100)};
  const arr = getScores();
  arr.push(entry);
  saveScores(arr);
  return entry;
}
function clearScores(){ localStorage.removeItem('quiz_scores') }

function renderScoreboard(openNow=false, currentEntry=null){
  const overlay = document.getElementById('overlay');
  const panel = document.getElementById('score-panel');
  const history = getScores();
  const historyList = document.getElementById('history-list');
  const bestRow = document.getElementById('best-row');
  const currentRun = document.getElementById('current-run');
  historyList.innerHTML='';
  bestRow.innerHTML='';
  currentRun.innerHTML='';
  if(currentEntry){
    currentRun.innerHTML = `<div style="font-weight:800">Current Run: ${currentEntry.correct}/${currentEntry.total} ‚Äî ${currentEntry.pct}%</div>`;
  }
  const last5 = history.slice(-5).reverse();
  last5.forEach(h=>{
    const div = document.createElement('div');
    div.className='score-row';
    div.innerHTML = `<div>${h.time}</div><div>${h.correct}/${h.total} ‚Äî ${h.pct}%</div>`;
    historyList.appendChild(div);
  });
  if(history.length>0){
    let best = history.reduce((b,a)=> a.pct>b.pct? a: b, history[0]);
    bestRow.innerHTML = `<div class="score-row best"><div><span class="crown">üëë</span><strong>Best: </strong>${best.time}</div><div><strong>${best.correct}/${best.total} ‚Äî ${best.pct}%</strong></div></div>`;
  } else {
    bestRow.innerHTML = `<div class="small">No scores yet</div>`;
  }
  if(openNow){
    overlay.style.display='flex';
    setTimeout(()=>panel.classList.add('open'),20);
  }
}

const scoreTab = document.getElementById('score-tab');
const overlay = document.getElementById('overlay');
const scorePanel = document.getElementById('score-panel');
const gear = document.getElementById('gear');
const settings = document.getElementById('settings');
const closeSettings = document.getElementById('close-settings');
const collapseScoreboard = document.getElementById('collapse-scoreboard');

let scoreOpen=false;
scoreTab.addEventListener('click', ()=>{ scoreOpen = !scoreOpen; if(scoreOpen){ renderScoreboard(true); } else { scorePanel.classList.remove('open'); setTimeout(()=>overlay.style.display='none',260); } });
collapseScoreboard.addEventListener('click', ()=>{ scoreOpen=false; scorePanel.classList.remove('open'); setTimeout(()=>overlay.style.display='none',260); });

let settingsOpen=false;
gear.addEventListener('click', ()=>{ settingsOpen = !settingsOpen; settings.classList.toggle('open', settingsOpen); settings.setAttribute('aria-hidden', !settingsOpen); if(settingsOpen){ overlay.style.display='flex'; overlay.onclick = (e)=>{ if(e.target===overlay){ settingsOpen=false; settings.classList.remove('open'); settings.setAttribute('aria-hidden', 'true'); overlay.style.display='none'; } } } else { overlay.style.display='none'; overlay.onclick=null } });
closeSettings.addEventListener('click', ()=>{ settingsOpen=false; settings.classList.remove('open'); settings.setAttribute('aria-hidden','true'); overlay.style.display='none'; overlay.onclick=null })

function closeScoreboard(){ scoreOpen=false; scorePanel.classList.remove('open'); setTimeout(()=>overlay.style.display='none',260); }

document.querySelectorAll('input[name="mode"]').forEach(el=>el.addEventListener('change', ()=>{ const timed = document.querySelector('input[name="mode"]:checked').value==='timed'; document.getElementById('timed-options').style.display = timed? 'block':'none'; }));

document.getElementById('music-toggle').addEventListener('change', (e)=>{ musicEnabled = e.target.checked; if(musicEnabled){ musicAudio.play().catch(()=>{}); } else { musicAudio.pause(); } });
document.getElementById('music-volume').addEventListener('input', (e)=>{ musicAudio.volume = parseFloat(e.target.value); });

document.getElementById('music-upload').addEventListener('change', (e)=>{ const file = e.target.files[0]; if(!file) return; const url = URL.createObjectURL(file); musicAudio.src = url; if(document.getElementById('music-toggle').checked){ musicAudio.play().catch(()=>{}); } });

document.getElementById('questions-upload').addEventListener('change', (e)=>{ const f = e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ()=>{ try{ const parsed = JSON.parse(reader.result); if(Array.isArray(parsed)){ originalQuestions = parsed; alert('Question pool loaded. Click Start Quiz to apply.'); } else { alert('Invalid format'); } }catch(err){ alert('Failed to parse JSON: '+err.message) } }; reader.readAsText(f); });

document.getElementById('clear-scores').addEventListener('click', ()=>{ if(confirm('Clear scoreboard history?')){ clearScores(); renderScoreboard(true); } });

document.getElementById('start-quiz').addEventListener('click', ()=>{ startQuiz(true); });
document.getElementById('start-quiz-norm').addEventListener('click', ()=>{ document.querySelector('input[name="mode"][value="normal"]').checked = true; document.getElementById('timed-options').style.display='none'; startQuiz(false); });

# rest of JS omitted in this cell for brevity; full code saved into index.html below
</script>
</body>
</html>
